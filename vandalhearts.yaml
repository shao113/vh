
# Note: Matching build requires splat 0.9.1 (or earlier), with sdata.py / sbss.py segtypes added manually.
# Build fails with the newer linker script, possibly due to alignment issues with my mostly arbitrary 
# splits; I'm hoping it will resolve itself as I match more of the gaps between segments.

options:

  platform: psx
  basename: vandalhearts

  base_path: .
  target_path: vandalhearts.psx
  asm_path: asm
  asset_path: assets
  src_path: src

  compiler: GCC

  generated_c_preamble: "#include \"include_asm.h\""
  symbol_addrs_path: symbol_addrs.vandalhearts.txt
  undefined_funcs_auto_path: undefined_funcs_auto.vandalhearts.txt
  undefined_syms_auto_path: undefined_syms_auto.vandalhearts.txt
  find_file_boundaries: True
  enable_ld_alignment_hack: False
  auto_decompile_empty_functions: False
  use_legacy_include_asm: False
  asm_function_macro: glabel
  use_legacy_include_asm: False
  gp_value: 0x80122e10
  auto_all_sections: [".data", ".rodata", ".rdata", ".bss"]
  #linker_discard_section: False
  #migrate_rodata_to_functions: no
  #create_elf_section_list_auto: True
  section_order:
  - .rodata
  - .rdata
  - .text
  - .data
  - .sdata
  - .sbss
  - .bss
segments:
  - [0x0, header]
  - [0x80, bin]
  - type: code
    start: 0x800
    vram: 0x80010000
    subalign: 4
    #align: 4
    subsegments:
    - [0x000800, rdata]                   # 0x80010000

    - [0x0019ec, .rdata, main]            # 0x800111ec
    - [0x001c04, .rdata, engine]          # 0x80011404
    - [0x001c20, rdata]                   # 0x80011420

    - [0x0033ec, .rdata, evt]             # 0x80012bec
    - [0x003500, rdata]                   # 0x80012d00

    - [0x0041d4, .rdata, card]            # 0x800139d4
    - [0x0041f4, rdata]                   # 0x800139f4

    - [0x006580, .rdata, audio]           # 0x80015d80 
    - [0x0069b0, bin]                     # 0x800161b0 end of audio jtbls

    - [0x007690, c, main]                 # 0x80016e90 main ...
    - [0x0084c0, c, engine]               # 0x80017cc0 UpdateEngine ...    
    - [0x00ab4c, bin]                     # 

    - [0x00e184, c, evtf574]              # 0x8001d984 Evtf574_DisplayIcon ...
    - [0x00e584, bin]                     # 0x8001dd84

    - [0x028814, c, evt]                  # 0x80038014 Evtf581_AudioCommand ...
    - [0x028f2c, bin]                     # 0x8003872c
    - [0x0318b4, c, battle_eval]          # 0x800410b4 FindUnitByNameIdx ...
    - [0x032ef0, bin]                     # 0x800426f0 (End of battle_eval)

    - [0x039e48, c, card]                 # 0x80049648 State_FileSaveScreen ...
    - [0x03c94c, bin]                     # 0x8004c14c (End of card functions) ShowMsgBoxForSprite

    - [0x0b4e60, c, audio]                # 0x800c4660 SetSeqDataPtr ...
    - [0x0b7ac8, bin]                     # 0x800c72c8 End of audio functions
    
    - [0x0d4dc8, data]                    # 0x800e45c8 Data?

    - [0x0db758, .data, gCharacterNames]  # 0x800eaf58
    - [0x0dc314, data]                    # 0x800ebb14

    - [0x0e1234, .data, engine]           # 0x800f0a34
    - [0x0e1384, .data, glyphs]           # 0x800f0b84

    - [0x0e1ed8, data]                    # 0x800f16d8
    - [0x0e3914, .data, gCdFiles]         # 0x800f3114
    - [0x0e5a74, data]
    - [0x0e5d4c, .data, card]             # 0x800f554c gCardFilePath
    - [0x0e5d60, data]                    # 0x800f5560 gCardFileHeader: part of card.data; omitted because of image data

    - [0x0e76a4, data, portrait_data]     # 0x800f6ea4
    - [0x0e9b58, data]                    # 0x800f9358
    - [0x0f76ec, bin]           # - TBD - # Why is this necessary?
    - [0x0f76f0, data]          # # # # # # 
    
    - [0x0f780c, .data, audio_data]       # 0x8010700c
    - [0x0f91d0, data]                    # 0x801089d0 lib data
    - [0x111a5c, bin]           # - TBD - # 
    - [0x111a60, data]          # # # # # # 

    - [0x113610, .sdata, temp_sdata]      # 0x80122e10 trying stuff
    - [0x113628, bin] 

    - [0x113674, .sdata, engine]          # 0x80122e74
    - [0x1136b4, bin] 

    - [0x113710, .sdata, card]            # 0x80122f10
    - [0x11372c, sdata]                   # 0x80122f2c

    # TODO: Need to figure out how to handle sbss without messing up order. Currently I just rely on the addresses
    # set through symbol_addrs to override the assembler's placement
    #- [0x113940, .sbss, engine]          # 0x80123140 TODO: .sbss?
    - [0x113940, bin]                     # 0x80123140 TODO: .sbss?

    #- [0x113ab0, .sbss, card]            # 0x801232b0
    #- [0x113ad8, bin]
    #- [0x114fd4, bss]                    # 0x801247d4
    #- [0x1156fc, .bss, audio]            # 0x80124efc
    #- [0x115704, bin]
    #- [0x16d7bc, .bss, card]

    #- [0x1d5ac4, bin] # 0x801e52c4 (More functions)
  - [0x1d4e90, bin] #0x801e4690
  - [0x1e7800] # TBD end of file
